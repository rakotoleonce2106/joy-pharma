{"version":3,"file":"esri-leaflet-geocoder.js","sources":["../src/helper.js","../src/Tasks/Geocode.js","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocode.js","../src/Classes/GeosearchCore.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Controls/Geosearch.js","../src/Providers/FeatureLayer.js","../src/Providers/MapService.js","../src/Providers/GeocodeService.js"],"sourcesContent":["export var WorldGeocodingServiceUrl = 'https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/';\n","import {\n  latLng,\n  latLngBounds\n} from 'leaflet';\nimport { Task, Util as EsriUtil } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../helper';\n\nexport var Geocode = Task.extend({\n  path: 'findAddressCandidates',\n\n  params: {\n    outSr: 4326,\n    forStorage: false,\n    outFields: '*',\n    maxLocations: 20\n  },\n\n  setters: {\n    address: 'address',\n    neighborhood: 'neighborhood',\n    city: 'city',\n    subregion: 'subregion',\n    region: 'region',\n    postal: 'postal',\n    country: 'country',\n    text: 'singleLine',\n    category: 'category',\n    token: 'token',\n    apikey: 'apikey',\n    key: 'magicKey',\n    fields: 'outFields',\n    forStorage: 'forStorage',\n    maxLocations: 'maxLocations',\n    // World Geocoding Service (only works with singleLine)\n    countries: 'sourceCountry'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    options.url = options.url || WorldGeocodingServiceUrl;\n    Task.prototype.initialize.call(this, options);\n  },\n\n  within: function (bounds) {\n    bounds = latLngBounds(bounds);\n    this.params.searchExtent = EsriUtil.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function (coords, radius) {\n    var centroid = latLng(coords);\n    this.params.location = centroid.lng + ',' + centroid.lat;\n    if (radius) {\n      this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    }\n    return this;\n  },\n\n  run: function (callback, context) {\n    if (this.options.token) {\n      this.params.token = this.options.token;\n    }\n    if (this.options.apikey) {\n      this.params.token = this.options.apikey;\n    }\n    if (this.options.customParam) {\n      this.params[this.options.customParam] = this.params.singleLine;\n      delete this.params.singleLine;\n    }\n\n    return this.request(function (error, response) {\n      var processor = this._processGeocoderResponse;\n      var results = (!error) ? processor(response) : undefined;\n      callback.call(context, error, { results: results }, response);\n    }, this);\n  },\n\n  _processGeocoderResponse: function (response) {\n    var results = [];\n\n    for (var i = 0; i < response.candidates.length; i++) {\n      var candidate = response.candidates[i];\n      if (candidate.extent) {\n        var bounds = EsriUtil.extentToBounds(candidate.extent);\n      }\n\n      results.push({\n        text: candidate.address,\n        bounds: bounds,\n        score: candidate.score,\n        latlng: latLng(candidate.location.y, candidate.location.x),\n        properties: candidate.attributes\n      });\n    }\n    return results;\n  }\n});\n\nexport function geocode (options) {\n  return new Geocode(options);\n}\n\nexport default geocode;\n","import { latLng } from 'leaflet';\nimport { Task } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../helper';\n\nexport var ReverseGeocode = Task.extend({\n  path: 'reverseGeocode',\n\n  params: {\n    outSR: 4326,\n    returnIntersection: false\n  },\n\n  setters: {\n    distance: 'distance',\n    language: 'langCode',\n    intersection: 'returnIntersection',\n    apikey: 'apikey'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    options.url = options.url || WorldGeocodingServiceUrl;\n    Task.prototype.initialize.call(this, options);\n  },\n\n  latlng: function (coords) {\n    var centroid = latLng(coords);\n    this.params.location = centroid.lng + ',' + centroid.lat;\n    return this;\n  },\n\n  run: function (callback, context) {\n    if (this.options.token) {\n      this.params.token = this.options.token;\n    }\n    if (this.options.apikey) {\n      this.params.token = this.options.apikey;\n    }\n    return this.request(function (error, response) {\n      var result;\n\n      if (!error) {\n        result = {\n          latlng: latLng(response.location.y, response.location.x),\n          address: response.address\n        };\n      } else {\n        result = undefined;\n      }\n\n      callback.call(context, error, result, response);\n    }, this);\n  }\n});\n\nexport function reverseGeocode (options) {\n  return new ReverseGeocode(options);\n}\n\nexport default reverseGeocode;\n","import {\n  latLng,\n  latLngBounds\n} from 'leaflet';\nimport { Task, Util as EsriUtil } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../helper';\n\nexport var Suggest = Task.extend({\n  path: 'suggest',\n\n  params: {},\n\n  setters: {\n    text: 'text',\n    category: 'category',\n    countries: 'countryCode',\n    maxSuggestions: 'maxSuggestions'\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    if (!options.url) {\n      options.url = WorldGeocodingServiceUrl;\n      options.supportsSuggest = true;\n    }\n    Task.prototype.initialize.call(this, options);\n  },\n\n  within: function (bounds) {\n    bounds = latLngBounds(bounds);\n    var center = bounds.getCenter();\n    var ne = bounds.getNorthWest();\n    this.params.location = center.lng + ',' + center.lat;\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\n    this.params.searchExtent = EsriUtil.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function (coords, radius) {\n    var centroid = latLng(coords);\n    this.params.location = centroid.lng + ',' + centroid.lat;\n    if (radius) {\n      this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    }\n    return this;\n  },\n\n  run: function (callback, context) {\n    if (this.options.supportsSuggest) {\n      return this.request(function (error, response) {\n        callback.call(context, error, response, response);\n      }, this);\n    } else {\n      console.warn('this geocoding service does not support asking for suggestions');\n    }\n  }\n\n});\n\nexport function suggest (options) {\n  return new Suggest(options);\n}\n\nexport default suggest;\n","import { Service } from 'esri-leaflet';\nimport { WorldGeocodingServiceUrl } from '../helper';\nimport geocode from '../Tasks/Geocode';\nimport reverseGeocode from '../Tasks/ReverseGeocode';\nimport suggest from '../Tasks/Suggest';\n\nexport var GeocodeService = Service.extend({\n  initialize: function (options) {\n    options = options || {};\n    if (options.apikey) {\n      options.token = options.apikey;\n    }\n    if (options.url) {\n      Service.prototype.initialize.call(this, options);\n      this._confirmSuggestSupport();\n    } else {\n      options.url = WorldGeocodingServiceUrl;\n      options.supportsSuggest = true;\n      Service.prototype.initialize.call(this, options);\n    }\n  },\n\n  geocode: function () {\n    return geocode(this);\n  },\n\n  reverse: function () {\n    return reverseGeocode(this);\n  },\n\n  suggest: function () {\n    // requires either the Esri World Geocoding Service or a <10.3 ArcGIS Server Geocoding Service that supports suggest.\n    return suggest(this);\n  },\n\n  _confirmSuggestSupport: function () {\n    this.metadata(function (error, response) {\n      if (error) { return; }\n      // pre 10.3 geocoding services dont list capabilities (and dont support maxLocations)\n      // only SOME individual services have been configured to support asking for suggestions\n      if (!response.capabilities) {\n        this.options.supportsSuggest = false;\n      } else if (response.capabilities.indexOf('Suggest') > -1) {\n        this.options.supportsSuggest = true;\n      } else {\n        this.options.supportsSuggest = false;\n      }\n      // whether the service supports suggest or not, utilize the metadata response to determine the appropriate parameter name for single line geocoding requests\n      this.options.customParam = response.singleLineAddressField.name;\n    }, this);\n  }\n});\n\nexport function geocodeService (options) {\n  return new GeocodeService(options);\n}\n\nexport default geocodeService;\n","import { Evented, Util, latLngBounds } from 'leaflet';\n\nexport var GeosearchCore = Evented.extend({\n\n  options: {\n    zoomToResult: true,\n    useMapBounds: 12,\n    searchBounds: null\n  },\n\n  initialize: function (control, options) {\n    Util.setOptions(this, options);\n    this._control = control;\n\n    if (!options || !options.providers || !options.providers.length) {\n      throw new Error('You must specify at least one provider');\n    }\n\n    this._providers = options.providers;\n  },\n\n  _geocode: function (text, key, provider) {\n    var activeRequests = 0;\n    var allResults = [];\n    var bounds;\n\n    var callback = Util.bind(function (error, results) {\n      activeRequests--;\n      if (error) {\n        return;\n      }\n\n      if (results) {\n        allResults = allResults.concat(results);\n      }\n\n      if (activeRequests <= 0) {\n        bounds = this._boundsFromResults(allResults);\n\n        this.fire('results', {\n          results: allResults,\n          bounds: bounds,\n          latlng: (bounds) ? bounds.getCenter() : undefined,\n          text: text\n        }, true);\n\n        if (this.options.zoomToResult && bounds) {\n          this._control._map.fitBounds(bounds);\n        }\n\n        this.fire('load');\n      }\n    }, this);\n\n    if (key) {\n      activeRequests++;\n      provider.results(text, key, this._searchBounds(), callback);\n    } else {\n      for (var i = 0; i < this._providers.length; i++) {\n        activeRequests++;\n        this._providers[i].results(text, key, this._searchBounds(), callback);\n      }\n    }\n  },\n\n  _suggest: function (text) {\n    var activeRequests = this._providers.length;\n    var suggestionsLength = 0;\n\n    var createCallback = Util.bind(function (text, provider) {\n      return Util.bind(function (error, suggestions) {\n        activeRequests = activeRequests - 1;\n        suggestionsLength += suggestions.length;\n\n        if (error) {\n          // an error occurred for one of the providers' suggest requests\n          this._control._clearProviderSuggestions(provider);\n\n          // perform additional cleanup when all requests are finished\n          this._control._finalizeSuggestions(activeRequests, suggestionsLength);\n\n          return;\n        }\n\n        if (suggestions.length) {\n          for (var i = 0; i < suggestions.length; i++) {\n            suggestions[i].provider = provider;\n          }\n        } else {\n          // we still need to update the UI\n          this._control._renderSuggestions(suggestions);\n        }\n\n        if (provider._lastRender !== text) {\n          this._control._clearProviderSuggestions(provider);\n        }\n\n        if (suggestions.length && this._control._input.value === text) {\n          provider._lastRender = text;\n          this._control._renderSuggestions(suggestions);\n        }\n\n        // perform additional cleanup when all requests are finished\n        this._control._finalizeSuggestions(activeRequests, suggestionsLength);\n      }, this);\n    }, this);\n\n    this._pendingSuggestions = [];\n\n    for (var i = 0; i < this._providers.length; i++) {\n      var provider = this._providers[i];\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\n      this._pendingSuggestions.push(request);\n    }\n  },\n\n  _searchBounds: function () {\n    if (this.options.searchBounds !== null) {\n      return this.options.searchBounds;\n    }\n\n    if (this.options.useMapBounds === false) {\n      return null;\n    }\n\n    if (this.options.useMapBounds === true) {\n      return this._control._map.getBounds();\n    }\n\n    if (this.options.useMapBounds <= this._control._map.getZoom()) {\n      return this._control._map.getBounds();\n    }\n\n    return null;\n  },\n\n  _boundsFromResults: function (results) {\n    if (!results.length) {\n      return;\n    }\n\n    var nullIsland = latLngBounds([0, 0], [0, 0]);\n    var resultBounds = [];\n    var resultLatlngs = [];\n\n    // collect the bounds and center of each result\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      resultLatlngs.push(result.latlng);\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\n        resultBounds.push(result.bounds);\n      }\n    }\n\n    // form a bounds object containing all center points\n    var bounds = latLngBounds(resultLatlngs);\n\n    // and extend it to contain all bounds objects\n    for (var j = 0; j < resultBounds.length; j++) {\n      bounds.extend(resultBounds[j]);\n    }\n\n    return bounds;\n  },\n\n  _getAttribution: function () {\n    var attribs = [];\n    var providers = this._providers;\n\n    for (var i = 0; i < providers.length; i++) {\n      if (providers[i].options.attribution) {\n        attribs.push(providers[i].options.attribution);\n      }\n    }\n\n    return attribs.join(', ');\n  }\n\n});\n\nexport function geosearchCore (control, options) {\n  return new GeosearchCore(control, options);\n}\n\nexport default geosearchCore;\n","import { GeocodeService } from '../Services/Geocode';\n\nexport var ArcgisOnlineProvider = GeocodeService.extend({\n  options: {\n    label: 'Places and Addresses',\n    maxResults: 5\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var request = this.suggest().text(text);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    if (this.options.nearby) {\n      // \"distance\"/\"radius\" is not supported by the ArcGIS Online Geocoder,\n      // so that is intentionally not passed here:\n      request.nearby(this.options.nearby);\n    }\n\n    if (this.options.countries) {\n      request.countries(this.options.countries);\n    }\n\n    if (this.options.categories) {\n      request.category(this.options.categories);\n    }\n\n    // 15 is the maximum number of suggestions that can be returned\n    request.maxSuggestions(this.options.maxResults);\n\n    return request.run(function (error, results, response) {\n      var suggestions = [];\n      if (!error) {\n        while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\n          var suggestion = response.suggestions.shift();\n          if (!suggestion.isCollection) {\n            suggestions.push({\n              text: suggestion.text,\n              unformattedText: suggestion.text,\n              magicKey: suggestion.magicKey\n            });\n          }\n        }\n      }\n      callback(error, suggestions);\n    }, this);\n  },\n\n  results: function (text, key, bounds, callback) {\n    var request = this.geocode().text(text);\n\n    if (key) {\n      request.key(key);\n    }\n    // in the future Address/StreetName geocoding requests that include a magicKey will always only return one match\n    request.maxLocations(this.options.maxResults);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    if (this.options.forStorage) {\n      request.forStorage(true);\n    }\n\n    if (this.options.nearby) {\n      // \"distance\"/\"radius\" is not supported by the ArcGIS Online Geocoder,\n      // so that is intentionally not passed here:\n      request.nearby(this.options.nearby);\n    }\n\n    if (this.options.countries) {\n      request.countries(this.options.countries);\n    }\n\n    if (this.options.categories) {\n      request.category(this.options.categories);\n    }\n\n    return request.run(function (error, response) {\n      callback(error, response.results);\n    }, this);\n  }\n});\n\nexport function arcgisOnlineProvider (options) {\n  return new ArcgisOnlineProvider(options);\n}\n\nexport default arcgisOnlineProvider;\n","import {\n  Control,\n  DomEvent,\n  DomUtil,\n  Evented,\n  Util,\n  latLngBounds\n} from 'leaflet';\nimport { geosearchCore } from '../Classes/GeosearchCore';\nimport { arcgisOnlineProvider } from '../Providers/ArcgisOnlineGeocoder';\nimport { Util as EsriUtil } from 'esri-leaflet';\n\nexport var Geosearch = Control.extend({\n  includes: Evented.prototype,\n\n  options: {\n    position: 'topleft',\n    collapseAfterResult: true,\n    expanded: false,\n    allowMultipleResults: true,\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search'\n  },\n\n  initialize: function (options) {\n    Util.setOptions(this, options);\n\n    if (!options || !options.providers || !options.providers.length) {\n      if (!options) {\n        options = {};\n      }\n      options.providers = [arcgisOnlineProvider()];\n    }\n\n    // instantiate the underlying class and pass along options\n    this._geosearchCore = geosearchCore(this, options);\n    this._geosearchCore._providers = options.providers;\n\n    // bubble each providers events to the control\n    this._geosearchCore.addEventParent(this);\n    for (var i = 0; i < this._geosearchCore._providers.length; i++) {\n      this._geosearchCore._providers[i].addEventParent(this);\n    }\n\n    this._geosearchCore._pendingSuggestions = [];\n\n    Control.prototype.initialize.call(this, options);\n  },\n\n  _renderSuggestions: function (suggestions) {\n    var currentGroup;\n\n    if (suggestions.length > 0) {\n      this._suggestions.style.display = 'block';\n    }\n\n    var list;\n    var header;\n    var suggestionTextArray = [];\n\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n      if (!header && this._geosearchCore._providers.length > 1 && currentGroup !== suggestion.provider.options.label) {\n        header = DomUtil.create('div', 'geocoder-control-header', suggestion.provider._contentsElement);\n        header.textContent = suggestion.provider.options.label;\n        header.innerText = suggestion.provider.options.label;\n        currentGroup = suggestion.provider.options.label;\n      }\n\n      if (!list) {\n        list = DomUtil.create('ul', 'geocoder-control-list', suggestion.provider._contentsElement);\n      }\n\n      if (suggestionTextArray.indexOf(suggestion.text) === -1) {\n        var suggestionItem = DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n        suggestionItem.innerHTML = suggestion.text;\n        suggestionItem.provider = suggestion.provider;\n        suggestionItem['data-magic-key'] = suggestion.magicKey;\n        suggestionItem.unformattedText = suggestion.unformattedText;\n      } else {\n        for (var j = 0; j < list.childNodes.length; j++) {\n          // if the same text already appears in the list of suggestions, append an additional ObjectID to its magicKey instead\n          if (list.childNodes[j].innerHTML === suggestion.text) {\n            list.childNodes[j]['data-magic-key'] += ',' + suggestion.magicKey;\n          }\n        }\n      }\n      suggestionTextArray.push(suggestion.text);\n    }\n\n    // when the geocoder position is either \"topleft\" or \"topright\":\n    // set the maxHeight of the suggestions box to:\n    //  map height\n    //  - suggestions offset (distance from top of suggestions to top of control)\n    //  - control offset (distance from top of control to top of map)\n    //  - 10 (extra padding)\n    if (this.getPosition().indexOf('top') > -1) {\n      this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\n    }\n\n    // when the geocoder position is either \"bottomleft\" or \"bottomright\":\n    // 1. set the maxHeight of the suggestions box to:\n    //  map height\n    //  - corner control container offsetHeight (height of container of bottom corner)\n    //  - control offsetHeight (height of geocoder control wrapper, the main expandable button)\n    // 2. to move it up, set the top of the suggestions box to:\n    //  negative offsetHeight of suggestions box (its own negative height now that it has children elements\n    //  - control offsetHeight (height of geocoder control wrapper, the main expandable button)\n    //  + 20 (extra spacing)\n    if (this.getPosition().indexOf('bottom') > -1) {\n      this._setSuggestionsBottomPosition();\n    }\n  },\n\n  _setSuggestionsBottomPosition: function () {\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._map._controlCorners[this.getPosition()].offsetHeight - this._wrapper.offsetHeight) + 'px';\n    this._suggestions.style.top = (-this._suggestions.offsetHeight - this._wrapper.offsetHeight + 20) + 'px';\n  },\n\n  _boundsFromResults: function (results) {\n    if (!results.length) {\n      return;\n    }\n\n    var nullIsland = latLngBounds([0, 0], [0, 0]);\n    var resultBounds = [];\n    var resultLatlngs = [];\n\n    // collect the bounds and center of each result\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      resultLatlngs.push(result.latlng);\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\n        resultBounds.push(result.bounds);\n      }\n    }\n\n    // form a bounds object containing all center points\n    var bounds = latLngBounds(resultLatlngs);\n\n    // and extend it to contain all bounds objects\n    for (var j = 0; j < resultBounds.length; j++) {\n      bounds.extend(resultBounds[j]);\n    }\n\n    return bounds;\n  },\n\n  clear: function () {\n    this._clearAllSuggestions();\n\n    if (this.options.collapseAfterResult) {\n      this._input.value = '';\n      this._lastValue = '';\n      this._input.placeholder = '';\n      DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\n    }\n\n    if (!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom) {\n      this._map.scrollWheelZoom.enable();\n    }\n  },\n\n  _clearAllSuggestions: function () {\n    this._suggestions.style.display = 'none';\n\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this._clearProviderSuggestions(this.options.providers[i]);\n    }\n  },\n\n  _clearProviderSuggestions: function (provider) {\n    provider._contentsElement.innerHTML = '';\n  },\n\n  _finalizeSuggestions: function (activeRequests, suggestionsLength) {\n    // check if all requests are finished to remove the loading indicator\n    if (!activeRequests) {\n      DomUtil.removeClass(this._input, 'geocoder-control-loading');\n\n      // when the geocoder position is either \"bottomleft\" or \"bottomright\",\n      // it is necessary in some cases to recalculate the maxHeight and top values of the this._suggestions element,\n      // even though this is also being done after each provider returns their own suggestions\n      if (this.getPosition().indexOf('bottom') > -1) {\n        this._setSuggestionsBottomPosition();\n      }\n\n      // also check if there were 0 total suggest results to clear the parent suggestions element\n      // otherwise its display value may be \"block\" instead of \"none\"\n      if (!suggestionsLength) {\n        this._clearAllSuggestions();\n      }\n    }\n  },\n\n  _setupClick: function () {\n    DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    this._input.focus();\n  },\n\n  disable: function () {\n    this._input.disabled = true;\n    DomUtil.addClass(this._input, 'geocoder-control-input-disabled');\n    DomEvent.removeListener(this._wrapper, 'click', this._setupClick, this);\n  },\n\n  enable: function () {\n    this._input.disabled = false;\n    DomUtil.removeClass(this._input, 'geocoder-control-input-disabled');\n    DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\n  },\n\n  getAttribution: function () {\n    var attribs = [];\n\n    for (var i = 0; i < this._providers.length; i++) {\n      if (this._providers[i].options.attribution) {\n        attribs.push(this._providers[i].options.attribution);\n      }\n    }\n\n    return attribs.join(', ');\n  },\n\n  geocodeSuggestion: function (e) {\n    var suggestionItem = e.target || e.srcElement;\n\n    if (\n      suggestionItem.classList.contains('geocoder-control-suggestions') ||\n      suggestionItem.classList.contains('geocoder-control-header')\n    ) {\n      return;\n    }\n\n    // make sure and point at the actual 'geocoder-control-suggestion'\n    if (suggestionItem.classList.length < 1) {\n      suggestionItem = suggestionItem.parentNode;\n    }\n\n    this._geosearchCore._geocode(suggestionItem.unformattedText, suggestionItem['data-magic-key'], suggestionItem.provider);\n    this.clear();\n  },\n\n  onAdd: function (map) {\n    // include 'Powered by Esri' in map attribution\n    EsriUtil.setEsriAttribution(map);\n\n    this._map = map;\n    this._wrapper = DomUtil.create('div', 'geocoder-control');\n    this._input = DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\n    this._input.title = this.options.title;\n\n    if (this.options.expanded) {\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n      this._input.placeholder = this.options.placeholder;\n    }\n\n    // create the main suggested results container element\n    this._suggestions = DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\n\n    // create a child contents container element for each provider inside of this._suggestions\n    // to maintain the configured order of providers for suggested results\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this.options.providers[i]._contentsElement = DomUtil.create('div', null, this._suggestions);\n    }\n\n    var credits = this._geosearchCore._getAttribution();\n\n    if (map.attributionControl) {\n      map.attributionControl.addAttribution(credits);\n    }\n\n    DomEvent.addListener(this._input, 'focus', function (e) {\n      this._input.placeholder = this.options.placeholder;\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    }, this);\n\n    DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\n\n    // make sure both click and touch spawn an address/poi search\n    DomEvent.addListener(this._suggestions, 'mousedown', this.geocodeSuggestion, this);\n\n    DomEvent.addListener(this._input, 'blur', function (e) {\n      // TODO: this is too greedy and should not \"clear\"\n      // when trying to use the scrollbar or clicking on a non-suggestion item (such as a provider header)\n      this.clear();\n    }, this);\n\n    DomEvent.addListener(this._input, 'keydown', function (e) {\n      var text = (e.target || e.srcElement).value;\n\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if (list[i] === selected) {\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch (e.keyCode) {\n        case 13:\n          /*\n            if an item has been selected, geocode it\n            if focus is on the input textbox, geocode only if multiple results are allowed and more than two characters are present, or if a single suggestion is displayed.\n            if less than two characters have been typed, abort the geocode\n          */\n          if (selected) {\n            this._input.value = selected.innerText;\n            this._geosearchCore._geocode(selected.unformattedText, selected['data-magic-key'], selected.provider);\n            this.clear();\n          } else if (this.options.allowMultipleResults && text.length >= 2) {\n            this._geosearchCore._geocode(this._input.value, undefined);\n            this.clear();\n          } else {\n            if (list.length === 1) {\n              DomUtil.addClass(list[0], 'geocoder-control-selected');\n              this._geosearchCore._geocode(list[0].innerHTML, list[0]['data-magic-key'], list[0].provider);\n            } else {\n              this.clear();\n              this._input.blur();\n            }\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 38:\n          if (selected) {\n            DomUtil.removeClass(selected, 'geocoder-control-selected');\n          }\n\n          var previousItem = list[selectedPosition - 1];\n\n          if (selected && previousItem) {\n            DomUtil.addClass(previousItem, 'geocoder-control-selected');\n          } else {\n            DomUtil.addClass(list[list.length - 1], 'geocoder-control-selected');\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 40:\n          if (selected) {\n            DomUtil.removeClass(selected, 'geocoder-control-selected');\n          }\n\n          var nextItem = list[selectedPosition + 1];\n\n          if (selected && nextItem) {\n            DomUtil.addClass(nextItem, 'geocoder-control-selected');\n          } else {\n            DomUtil.addClass(list[0], 'geocoder-control-selected');\n          }\n          DomEvent.preventDefault(e);\n          break;\n        default:\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\n            var request = this._geosearchCore._pendingSuggestions[x];\n            if (request && request.abort && !request.id) {\n              request.abort();\n            }\n          }\n          break;\n      }\n    }, this);\n\n    DomEvent.addListener(this._input, 'keyup', Util.throttle(function (e) {\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if (text.length < 2) {\n        this._lastValue = this._input.value;\n        this._clearAllSuggestions();\n        DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if (key === 27) {\n        this._clearAllSuggestions();\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if (key !== 13 && key !== 38 && key !== 40) {\n        if (this._input.value !== this._lastValue) {\n          this._lastValue = this._input.value;\n          DomUtil.addClass(this._input, 'geocoder-control-loading');\n          this._geosearchCore._suggest(text);\n        }\n      }\n    }, 50, this), this);\n\n    DomEvent.disableClickPropagation(this._wrapper);\n\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\n    DomEvent.addListener(this._suggestions, 'mouseover', function (e) {\n      if (map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\n        map.scrollWheelZoom.disable();\n      }\n    });\n\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\n    DomEvent.addListener(this._suggestions, 'mouseout', function (e) {\n      if (!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\n        map.scrollWheelZoom.enable();\n      }\n    });\n\n    this._geosearchCore.on('load', function (e) {\n      DomUtil.removeClass(this._input, 'geocoder-control-loading');\n      this.clear();\n      this._input.blur();\n    }, this);\n\n    return this._wrapper;\n  }\n});\n\nexport function geosearch (options) {\n  return new Geosearch(options);\n}\n\nexport default geosearch;\n","import { Util, geoJson, latLngBounds } from 'leaflet';\nimport { FeatureLayerService } from 'esri-leaflet';\n\nexport var FeatureLayerProvider = FeatureLayerService.extend({\n  options: {\n    label: 'Feature Layer',\n    maxResults: 5,\n    bufferRadius: 1000,\n    searchMode: 'contain',\n    formatSuggestion: function (feature) {\n      return feature.properties[this.options.searchFields[0]];\n    }\n  },\n\n  initialize: function (options) {\n    if (options.apikey) {\n      options.token = options.apikey;\n    }\n    FeatureLayerService.prototype.initialize.call(this, options);\n    if (typeof this.options.searchFields === 'string') {\n      this.options.searchFields = [this.options.searchFields];\n    }\n    this._suggestionsQuery = this.query();\n    this._resultsQuery = this.query();\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var query = this._suggestionsQuery.where(this._buildQuery(text))\n      .returnGeometry(false);\n\n    if (bounds) {\n      query.intersects(bounds);\n    }\n\n    if (this.options.idField) {\n      query.fields([this.options.idField].concat(this.options.searchFields));\n    }\n\n    var request = query.run(function (error, results, raw) {\n      if (error) {\n        callback(error, []);\n      } else {\n        this.options.idField = raw.objectIdFieldName;\n        var suggestions = [];\n        for (var i = results.features.length - 1; i >= 0; i--) {\n          var feature = results.features[i];\n          suggestions.push({\n            text: this.options.formatSuggestion.call(this, feature),\n            unformattedText: feature.properties[this.options.searchFields[0]],\n            magicKey: feature.id\n          });\n        }\n        callback(error, suggestions.slice(0, this.options.maxResults));\n      }\n    }, this);\n\n    return request;\n  },\n\n  results: function (text, key, bounds, callback) {\n    var query = this._resultsQuery;\n\n    if (key) {\n      // if there are 1 or more keys available, use query.featureIds()\n      delete query.params.where;\n      query.featureIds([key]);\n    } else {\n      // if there are no keys available, use query.where()\n      query.where(this._buildQuery(text));\n    }\n\n    if (bounds) {\n      query.within(bounds);\n    }\n\n    return query.run(Util.bind(function (error, features) {\n      var results = [];\n      for (var i = 0; i < features.features.length; i++) {\n        var feature = features.features[i];\n        if (feature) {\n          var bounds = this._featureBounds(feature);\n\n          var result = {\n            latlng: bounds.getCenter(),\n            bounds: bounds,\n            text: this.options.formatSuggestion.call(this, feature),\n            properties: feature.properties,\n            geojson: feature\n          };\n\n          results.push(result);\n\n          // clear query parameters for the next search\n          delete this._resultsQuery.params['objectIds'];\n        }\n      }\n      callback(error, results);\n    }, this));\n  },\n\n  orderBy: function (fieldName, order) {\n    this._suggestionsQuery.orderBy(fieldName, order);\n  },\n\n  _buildQuery: function (text) {\n    var queryString = [];\n\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\n      var field = 'upper(\"' + this.options.searchFields[i] + '\")';\n      if (this.options.searchMode === 'contain') {\n        queryString.push(field + \" LIKE upper('%\" + text + \"%')\");\n      } else if (this.options.searchMode === 'startWith') {\n        queryString.push(field + \" LIKE upper('\" + text + \"%')\");\n      } else if (this.options.searchMode === 'endWith') {\n        queryString.push(field + \" LIKE upper('%\" + text + \"')\");\n      } else if (this.options.searchMode === 'strict') {\n        queryString.push(field + \" LIKE upper('\" + text + \"')\");\n      } else {\n        throw new Error('L.esri.Geocoding.featureLayerProvider: Invalid parameter for \"searchMode\". Use one of \"contain\", \"startWith\", \"endWith\", or \"strict\"');\n      }\n    }\n    if (this.options.where) {\n      return this.options.where + ' AND (' + queryString.join(' OR ') + ')';\n    } else {\n      return queryString.join(' OR ');\n    }\n  },\n\n  _featureBounds: function (feature) {\n    var geojson = geoJson(feature);\n    if (feature.geometry.type === 'Point') {\n      var center = geojson.getBounds().getCenter();\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\n      return latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\n    } else {\n      return geojson.getBounds();\n    }\n  }\n});\n\nexport function featureLayerProvider (options) {\n  return new FeatureLayerProvider(options);\n}\n\nexport default featureLayerProvider;\n","import { Util, geoJson, latLngBounds } from 'leaflet';\nimport { MapService } from 'esri-leaflet';\n\nexport var MapServiceProvider = MapService.extend({\n  options: {\n    layers: [0],\n    label: 'Map Service',\n    bufferRadius: 1000,\n    maxResults: 5,\n    formatSuggestion: function (feature) {\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\n    }\n  },\n\n  initialize: function (options) {\n    if (options.apikey) {\n      options.token = options.apikey;\n    }\n    MapService.prototype.initialize.call(this, options);\n    this._getIdFields();\n  },\n\n  suggestions: function (text, bounds, callback) {\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\n\n    return request.run(function (error, results, raw) {\n      var suggestions = [];\n      if (!error) {\n        var count = Math.min(this.options.maxResults, results.features.length);\n        raw.results = raw.results.reverse();\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          var result = raw.results[i];\n          var layer = result.layerId;\n          var idField = this._idFields[layer];\n          feature.layerId = layer;\n          feature.layerName = this._layerNames[layer];\n          feature.displayFieldName = this._displayFields[layer];\n          if (idField) {\n            suggestions.push({\n              text: this.options.formatSuggestion.call(this, feature),\n              unformattedText: feature.properties[feature.displayFieldName],\n              magicKey: result.attributes[idField] + ':' + layer\n            });\n          }\n        }\n      }\n      callback(error, suggestions.reverse());\n    }, this);\n  },\n\n  results: function (text, key, bounds, callback) {\n    var results = [];\n    var request;\n\n    if (key && !key.includes(',')) {\n      // if there is only 1 key available, use query()\n      var featureId = key.split(':')[0];\n      var layer = key.split(':')[1];\n      request = this.query().layer(layer).featureIds(featureId);\n    } else {\n      // if there are no keys or more than 1 keys available, use find()\n      request = this.find().text(text).fields(this.options.searchFields).layers(this.options.layers);\n    }\n\n    return request.run(function (error, features, response) {\n      if (!error) {\n        if (response.results) {\n          response.results = response.results.reverse();\n        }\n        for (var i = 0; i < features.features.length; i++) {\n          var feature = features.features[i];\n          layer = layer || response.results[i].layerId;\n\n          if (feature && layer !== undefined) {\n            var bounds = this._featureBounds(feature);\n            feature.layerId = layer;\n            feature.layerName = this._layerNames[layer];\n            feature.displayFieldName = this._displayFields[layer];\n\n            var result = {\n              latlng: bounds.getCenter(),\n              bounds: bounds,\n              text: this.options.formatSuggestion.call(this, feature),\n              properties: feature.properties,\n              geojson: feature\n            };\n\n            results.push(result);\n          }\n        }\n      }\n      callback(error, results.reverse());\n    }, this);\n  },\n\n  _featureBounds: function (feature) {\n    var geojson = geoJson(feature);\n    if (feature.geometry.type === 'Point') {\n      var center = geojson.getBounds().getCenter();\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\n      return latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\n    } else {\n      return geojson.getBounds();\n    }\n  },\n\n  _layerMetadataCallback: function (layerid) {\n    return Util.bind(function (error, metadata) {\n      if (error) { return; }\n      this._displayFields[layerid] = metadata.displayField;\n      this._layerNames[layerid] = metadata.name;\n      for (var i = 0; i < metadata.fields.length; i++) {\n        var field = metadata.fields[i];\n        if (field.type === 'esriFieldTypeOID') {\n          this._idFields[layerid] = field.name;\n          break;\n        }\n      }\n    }, this);\n  },\n\n  _getIdFields: function () {\n    this._idFields = {};\n    this._displayFields = {};\n    this._layerNames = {};\n    for (var i = 0; i < this.options.layers.length; i++) {\n      var layer = this.options.layers[i];\n      this.get(layer, {}, this._layerMetadataCallback(layer));\n    }\n  }\n});\n\nexport function mapServiceProvider (options) {\n  return new MapServiceProvider(options);\n}\n\nexport default mapServiceProvider;\n","import { GeocodeService } from '../Services/Geocode';\n\nexport var GeocodeServiceProvider = GeocodeService.extend({\n  options: {\n    label: 'Geocode Server',\n    maxResults: 5\n  },\n\n  suggestions: function (text, bounds, callback) {\n    if (this.options.supportsSuggest) {\n      var request = this.suggest().text(text);\n      if (bounds) {\n        request.within(bounds);\n      }\n\n      return request.run(function (error, results, response) {\n        var suggestions = [];\n        if (!error) {\n          while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\n            var suggestion = response.suggestions.shift();\n            if (!suggestion.isCollection) {\n              suggestions.push({\n                text: suggestion.text,\n                unformattedText: suggestion.text,\n                magicKey: suggestion.magicKey\n              });\n            }\n          }\n        }\n        callback(error, suggestions);\n      }, this);\n    } else {\n      callback(null, []);\n      return false;\n    }\n  },\n\n  results: function (text, key, bounds, callback) {\n    var request = this.geocode().text(text);\n\n    if (key) {\n      request.key(key);\n    }\n\n    request.maxLocations(this.options.maxResults);\n\n    if (bounds) {\n      request.within(bounds);\n    }\n\n    return request.run(function (error, response) {\n      callback(error, response.results);\n    }, this);\n  }\n});\n\nexport function geocodeServiceProvider (options) {\n  return new GeocodeServiceProvider(options);\n}\n\nexport default geocodeServiceProvider;\n"],"names":["WorldGeocodingServiceUrl","Geocode","Task","extend","path","params","outSr","forStorage","outFields","maxLocations","setters","address","neighborhood","city","subregion","region","postal","country","text","category","token","apikey","key","fields","countries","initialize","options","url","prototype","call","this","within","bounds","latLngBounds","searchExtent","EsriUtil","Util","boundsToExtent","nearby","coords","radius","centroid","latLng","location","lng","lat","distance","Math","min","max","run","callback","context","customParam","singleLine","request","error","response","processor","_processGeocoderResponse","results","undefined","i","candidates","length","candidate","extent","extentToBounds","push","score","latlng","y","x","properties","attributes","geocode","ReverseGeocode","outSR","returnIntersection","language","intersection","result","reverseGeocode","Suggest","maxSuggestions","supportsSuggest","center","getCenter","ne","getNorthWest","distanceTo","console","warn","suggest","GeocodeService","Service","_confirmSuggestSupport","reverse","metadata","capabilities","indexOf","singleLineAddressField","name","GeosearchCore","Evented","zoomToResult","useMapBounds","searchBounds","control","setOptions","_control","providers","Error","_providers","_geocode","provider","activeRequests","allResults","bind","concat","_boundsFromResults","fire","_map","fitBounds","_searchBounds","_suggest","suggestionsLength","createCallback","suggestions","_clearProviderSuggestions","_finalizeSuggestions","_renderSuggestions","_lastRender","_input","value","_pendingSuggestions","getZoom","getBounds","nullIsland","resultBounds","resultLatlngs","isValid","equals","j","_getAttribution","attribs","attribution","join","geosearchCore","ArcgisOnlineProvider","label","maxResults","categories","suggestion","shift","isCollection","unformattedText","magicKey","arcgisOnlineProvider","Geosearch","Control","includes","position","collapseAfterResult","expanded","allowMultipleResults","placeholder","title","_geosearchCore","addEventParent","currentGroup","list","header","_suggestions","style","display","suggestionTextArray","DomUtil","create","_contentsElement","textContent","innerText","suggestionItem","innerHTML","childNodes","getPosition","maxHeight","getSize","offsetTop","_wrapper","_setSuggestionsBottomPosition","_controlCorners","offsetHeight","top","clear","_clearAllSuggestions","_lastValue","removeClass","scrollWheelZoom","enabled","enable","_setupClick","addClass","focus","disable","disabled","DomEvent","removeListener","addListener","getAttribution","geocodeSuggestion","e","target","srcElement","classList","contains","parentNode","onAdd","map","setEsriAttribution","credits","attributionControl","addAttribution","selectedPosition","querySelectorAll","selected","keyCode","blur","preventDefault","previousItem","nextItem","abort","id","throttle","which","disableClickPropagation","on","FeatureLayerProvider","FeatureLayerService","bufferRadius","searchMode","formatSuggestion","feature","searchFields","_suggestionsQuery","query","_resultsQuery","where","_buildQuery","returnGeometry","intersects","idField","raw","objectIdFieldName","features","slice","featureIds","_featureBounds","geojson","orderBy","fieldName","order","queryString","field","geoJson","geometry","type","lngRadius","cos","PI","latRadius","MapServiceProvider","MapService","layers","displayFieldName","layerName","_getIdFields","find","count","layer","layerId","_idFields","_layerNames","_displayFields","featureId","split","_layerMetadataCallback","layerid","displayField","get","GeocodeServiceProvider"],"mappings":"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"}